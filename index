<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AC TUSCOLANO - Team Manager</title>
    
    <!-- ðŸ”‘ CORREZIONE CRITICA: Content Security Policy (CSP) -->
    <!-- Ho aggiornato img-src per includere 'self', consentendo il caricamento di favicon.ico e altre immagini locali. -->
    <meta http-equiv="Content-Security-Policy" 
          content="default-src 'self'; 
                   script-src 'self' https://cdn.tailwindcss.com https://unpkg.com https://www.gstatic.com 'unsafe-inline'; 
                   style-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com; 
                   font-src 'self' data:; 
                   connect-src 'self' https://*.firebaseio.com https://firestore.googleapis.com; 
                   img-src 'self' data:;" />
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <link rel="stylesheet" href="style.css">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#C0392B',
                        secondary: '#F1C40F',
                        accent: '#2C3E50',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-100">

<div id="app-container" class="app-container bg-white">

    <header class="bg-accent p-4 shadow-lg sticky top-0 z-10">
        <div class="flex items-center justify-between">
            <h1 class="text-xl font-extrabold text-white tracking-wider flex items-center">
                <span class="bg-primary text-secondary px-2 py-1 rounded-full mr-2">AC</span>
                TUSCOLANO
            </h1>
            <button id="admin-button" class="text-white hover:text-secondary p-2 rounded-full hidden" title="Pannello di Amministrazione" onclick="toggleAdminModal(true)">
                <i data-lucide="settings" class="lucide w-6 h-6"></i>
            </button>
        </div>
        <div class="text-center text-xs text-gray-300 mt-1">
            (Logo "AC Tuscolano" qui)
        </div>
    </header>

    <nav class="flex justify-around bg-white border-b border-gray-200 shadow-md p-2">
        <button id="nav-stats" onclick="showView('stats')" class="tab-button flex-1 text-center py-2 font-semibold text-accent border-b-2 border-primary transition-all duration-300">
            <i data-lucide="layout-dashboard" class="lucide w-5 h-5 mx-auto mb-1"></i> Statistiche
        </button>
        <button id="nav-calendar" onclick="showView('calendar')" class="tab-button flex-1 text-center py-2 font-semibold text-gray-500 border-b-2 border-transparent hover:border-gray-300 transition-all duration-300">
            <i data-lucide="calendar" class="lucide w-5 h-5 mx-auto mb-1"></i> Calendario
        </button>
    </nav>

    <main class="p-4 flex-grow overflow-y-auto">

        <section id="stats-view" class="view">
            <h2 class="text-2xl font-bold mb-4 text-accent border-b-2 pb-2 border-primary">Classifica Giocatori</h2>
            <div id="loading-stats" class="text-center text-gray-500 p-8">
                Caricamento statistiche...
            </div>
            <div id="player-list-container">
                </div>
        </section>

        <section id="calendar-view" class="view hidden">
            <h2 class="text-2xl font-bold mb-4 text-accent border-b-2 pb-2 border-primary">Calendario Incontri (Clicca per Dettagli Partita)</h2>
            <div id="loading-calendar" class="text-center text-gray-500 p-8">
                Caricamento calendario...
            </div>
            <div id="upcoming-matches" class="mb-6">
                <h3 class="text-xl font-semibold mb-3 text-primary">Prossimi Incontri</h3>
                <div id="upcoming-list" class="space-y-3"></div>
            </div>
            <div id="past-matches">
                <h3 class="text-xl font-semibold mb-3 text-primary">Risultati Precedenti</h3>
                <div id="past-list" class="space-y-3"></div>
            </div>
        </section>

    </main>

    <footer class="p-3 text-center text-xs text-gray-500 border-t">
        AC TUSCOLANO - App Ufficiale (Non-profit)
    </footer>
</div>

<div id="admin-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 z-50 flex items-center justify-center hidden">
    <div class="bg-white p-6 rounded-lg shadow-xl w-11/12 max-w-lg">
        <h3 class="text-2xl font-bold text-accent mb-4 border-b pb-2">Gestione Dati (Admin)</h3>
        <p class="text-sm text-gray-600 mb-4">
            **ATTENZIONE:** Questo codice utilizza variabili d'ambiente (non presenti su Github) per la configurazione di Firebase.
            Per l'uso su GitHub, Ã¨ necessario inserire le proprie credenziali valide di Firebase Config in `script.js`.
        </p>
        <p class="text-sm text-gray-600 mb-4">
            I dati di prova verranno salvati in:
            <ul class="list-disc list-inside space-y-1 ml-4 mt-2 text-xs font-mono bg-gray-50 p-2 rounded">
                <li>**Giocatori:** <span id="path-players" class="text-primary">/artifacts/[appId]/public/data/ac_tuscolano_players</span></li>
                <li>**Partite:** <span id="path-matches" class="text-primary">/artifacts/[appId]/public/data/ac_tuscolano_matches</span></li>
            </ul>
        </p>
        <button onclick="addInitialMockData()" class="w-full bg-primary text-white font-bold py-3 rounded-lg hover:bg-red-700 transition-colors duration-300 shadow-md">
            <i data-lucide="database" class="lucide w-5 h-5 mr-2 inline-block"></i> Inserisci Dati di Prova in Firestore
        </button>
        <button onclick="toggleAdminModal(false)" class="w-full mt-3 bg-gray-300 text-gray-800 font-semibold py-2 rounded-lg hover:bg-gray-400 transition-colors duration-300">
            Chiudi
        </button>
    </div>
</div>

<div id="match-detail-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 z-40 flex items-center justify-center hidden">
    <div class="bg-white p-6 rounded-lg shadow-2xl w-11/12 max-w-xl max-h-[90vh] overflow-y-auto">
        <div class="flex justify-between items-center border-b pb-3 mb-4">
            <div>
                <h3 id="match-detail-title" class="text-xl font-bold text-accent">Dettaglio Partita</h3>
                <p id="match-detail-subtitle" class="text-sm text-gray-500"></p>
            </div>
            <button onclick="closeMatchDetail()" class="text-gray-500 hover:text-accent">
                <i data-lucide="x" class="lucide w-6 h-6"></i>
            </button>
        </div>

        <div class="space-y-4">
            <div class="flex justify-between items-center bg-gray-100 p-3 rounded-lg">
                <button id="prev-formation-btn" onclick="navigateFormation(-1)" class="p-2 bg-primary text-white rounded-full disabled:bg-gray-400 hover:bg-red-700 transition-colors duration-300">
                    <i data-lucide="chevron-left" class="lucide w-5 h-5"></i>
                </button>
                <div class="text-center">
                    <p class="font-bold text-accent">Formazione: <span id="current-formation-index">1 di 1</span></p>
                    <p id="formation-description" class="text-sm text-gray-600 italic"></p>
                </div>
                <button id="next-formation-btn" onclick="navigateFormation(1)" class="p-2 bg-primary text-white rounded-full disabled:bg-gray-400 hover:bg-red-700 transition-colors duration-300">
                    <i data-lucide="chevron-right" class="lucide w-5 h-5"></i>
                </button>
            </div>

            <div id="pitch-container" class="relative w-full aspect-[2/3]">
                </div>

            <div id="formation-table-container">
                </div>
        </div>
    </div>
</div>

<script type="module" src="script.js"></script>

</body>
</html>
